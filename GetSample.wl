(* ::Package:: *)

(*-------Set the fixed parameters of the model-----------------*)
op={2.3313783727317956`,2.3946043079760524`,2.688513028433753`,1.790074410176337`,
6.501909578795749`,15.913784004903405`,5.211713233617408`,10.379195308853102`,0.997,0.927,100,365,400,74,400};
(*--------------------------------------------------------------------------*)
(*--------experimental data contained in the following dataAll array--------*)
dataAll={{{{0.142425187032419`,0.117425187032419`,0.12052518703241899`,0.13060000000000002`,0.1357454005934718`,0.1492454005934718`,0.1412454005934718`,0.1267308277291502`,0.1087308277291502`,0.12758542713567841`,0.14158542713567843`,0.177484429629444`,0.1618990024937656`,0.1998990024937656`,0.19039900249376562`,0.1591481663733642`,0.1507491638795986`,0.1837491638795986`,0.18974916387959861`,0.20724916387959863`,0.22050000000000003`,0.213`,0.21600000000000003`,0.20800000000000002`,0.20700000000000005`,0.2015`,0.18466283524904215`,0.21016283524904217`,0.21666283524904217`,0.18966283524904215`,0.18066283524904214`,0.1855`,0.202`,0.16937500000000003`,0.2367367021276596`,0.24121289260385004`,0.28971289260385`,0.31671289260385005`,0.36533789260385`,0.3219761904761904`,0.347`,0.40149999999999997`,0.42800000000000005`,0.4465`,0.46049999999999996`,0.5055`,0.5595000000000001`,0.5355`,0.525`,0.5680000000000001`,0.6175000000000002`,0.5795`,0.592`,0.6205`,0.6635000000000001`,0.6685000000000001`,0.6875`,0.6990000000000001`,0.7160000000000001`,0.7155`,0.7290000000000001`,0.7475`,0.793`,0.8330000000000001`,0.8705`,0.9039999999999999`,0.9305`,0.9495000000000001`,0.9660000000000001`,0.9824999999999999`,0.9830000000000001`,0.9865`,0.9890000000000001`,0.9984999999999999`,0.9990000000000001`,0.9990000000000001`},{0.18300000000000002`,0.1465`,0.09350000000000001`,0.08400000000000002`,0.1605`,0.12350000000000001`,0.1125`,0.14250000000000002`,0.18000000000000002`,0.12650000000000003`,0.1605`,0.20450000000000002`,0.2295`,0.21800000000000003`,0.273235632183908`,0.314235632183908`,0.34273563218390807`,0.351132183908046`,0.45463218390804605`,0.45539655172413807`,0.48839655172413804`,0.49989655172413805`,0.5345`,0.5265`,0.5797586206896552`,0.5581533575317604`,0.6003052562659377`,0.6618052562659377`,0.6843052562659376`,0.6755466355762825`,0.7656518987341774`,0.8215`,0.8585000000000002`,0.885`,0.94`,0.9415`,0.9535`,0.8805000000000001`,0.891`,0.9120000000000001`,0.9125000000000001`,0.86`,0.9060000000000001`,0.8573029739776953`,0.8573029739776953`,0.8478029739776952`,0.8923029739776953`,0.8873029739776952`,0.9175000000000001`,0.9050000000000001`,0.9115000000000001`,0.9135`,0.9445000000000001`,0.9775`,0.9895`,0.9925000000000002`,0.9984999999999999`,0.9995000000000002`,0.9995000000000002`,1.`,1.`,1.`,1.`,1.`,1.`,1.`,1.`,1.`,1.`,1.`,1.`,1.`,1.`,1.`,1.`,1.`}},{{0.18000000000000005`,0.20450000000000002`,0.1965`,0.1955`,0.21199999999999997`,0.26699999999999996`,0.23836170212765959`,0.2689159189951294`,0.31066156359443264`,0.28232156359443267`,0.23932156359443263`,0.28895986146677305`,0.3118256445993033`,0.24308000000000002`,0.26694830188679236`,0.2694238263623168`,0.31026122473630063`,0.2888412247363006`,0.3262400686669364`,0.339711766780144`,0.37023624230461966`,0.2513988439306358`,0.21639884393063583`,0.191`,0.20450000000000002`,0.184`,0.179`,0.21200000000000002`,0.2335`,0.20700000000000005`,0.261`,0.36200000000000004`,0.37250000000000005`,0.43200000000000005`,0.44622829581993567`,0.5062282958199357`,0.5017282958199356`,0.5277282958199357`,0.5347282958199356`,0.5965`,0.5695`,0.6105`,0.625`,0.654`,0.707`,0.7295`,0.7675000000000001`,0.7925`,0.8414999999999999`,0.8567753623188405`,0.9012753623188406`,0.8712753623188405`,0.9027753623188407`,0.9147753623188406`,0.9455`,0.9440000000000002`,0.9824999999999999`,0.9870000000000001`,0.9870000000000001`,0.9870000000000001`,1.`,1.`,1.`,1.`,1.`,1.`,1.`,1.`,1.`,1.`,1.`,1.`,1.`,1.`,1.`,1.`},{0.158`,0.1555482233502538`,0.1160482233502538`,0.13054822335025382`,0.1291482233502538`,0.1336482233502538`,0.12210000000000001`,0.1121`,0.0936`,0.1385`,0.22200000000000003`,0.21050000000000005`,0.20900000000000005`,0.23000000000000004`,0.24536642599277983`,0.2273664259927798`,0.2153052749136431`,0.21130527491364315`,0.1955729097684149`,0.15470648377563512`,0.11470648377563511`,0.14226763485477179`,0.15776763485477177`,0.20350000000000001`,0.29900000000000004`,0.343570796460177`,0.323570796460177`,0.366070796460177`,0.398570796460177`,0.3979681571639894`,0.35439736070381245`,0.4183973607038125`,0.43989736070381236`,0.48518307498952656`,0.44528571428571423`,0.5007857142857142`,0.5282857142857142`,0.5620677655677654`,0.5412820512820512`,0.6017820512820512`,0.6217820512820512`,0.7152820512820512`,0.731`,0.7835000000000001`,0.7855`,0.851`,0.8240000000000001`,0.835`,0.8560000000000001`,0.8985`,0.9025000000000001`,0.918`,0.9510000000000001`,0.9500000000000001`,0.9500000000000001`,0.9545`,0.968`,0.9765000000000001`,0.9855`,0.9820000000000001`,0.9885`,0.9925000000000002`,0.993`,0.993`,0.9965`,1.`,1.`,1.`,1.`,1.`,1.`,1.`,1.`,1.`,1.`,1.`}}},{{0.009932191826610056`,0.00890716306730161`},{0.014890668472769647`,0.011801675923225792`}},{{{0.5594756236267803`,0.5363257185034407`,0.55555648773421`,0.5689803188050998`,0.5264406362654173`,0.5397105130851262`,0.5195424458582353`,0.5363693689351584`,0.5209847535505431`,0.5346599672257567`,0.5349986853080914`,0.5809299692140587`,0.6371799692140587`,0.652495284529374`,0.681078722948878`,0.6993205471312963`,0.6838040097691076`,0.5963040097691076`,0.5865886944537922`,0.5586669599217986`,0.5580027839151569`,0.5373282971116379`,0.5424753559351673`,0.5593978784576897`,0.5873548677050016`,0.6636819224995222`,0.6932273770449767`,0.6842010078766197`,0.6727895964652083`,0.6287862879457707`,0.5797373749022924`,0.5503895488153359`,0.5641372802127952`,0.5591486180812758`,0.5588112361649465`,0.5046021704850205`,0.5186845098463134`,0.4992007041782971`,0.5130782551987053`,0.5273597454411655`,0.5262158424441397`,0.5562073565670635`,0.5885686428217924`,0.5927791691375818`,0.5951643455617884`,0.6248533894443807`,0.6180466167055055`,0.6142016812497362`,0.5953803764908329`,0.6282352409246447`,0.6406054528632019`,0.6159865934617339`,0.6009492636417955`,0.5973782239030909`,0.5931313758606225`,0.5788739158492502`,0.5966604771140722`,0.5835226472020488`,0.6188692163417215`,0.6371020783702039`,0.6666684341221267`,0.6566071186260285`,0.6839695474685333`,0.6708788705847529`,0.6828887707969004`,0.7053712607467533`,0.740387286387779`,0.7653546066492167`,0.8219256938654653`,0.8159965894978932`,0.828133982588976`,0.8543896132196066`,0.8988340576640511`,0.9181888963737287`,0.9487149719186333`,0.9549031696857784`},{0.4137301587301588`,0.40284780578898227`,0.3926138876603273`,0.47832817337461303`,0.5497567448031845`,0.6453449800973021`,0.648663230474376`,0.6533415930474755`,0.5607490004548827`,0.4944486341545165`,0.5151394686278408`,0.4988356466636414`,0.5067888630379105`,0.5233814556305031`,0.5382532505022979`,0.5227260604341042`,0.5719807252938977`,0.5806941755862954`,0.6038206123679046`,0.6140166907992771`,0.6461762035050923`,0.6320496257752267`,0.6176183305747007`,0.569979073280271`,0.5442364361444451`,0.5153250437393817`,0.5250922783980296`,0.5634834365452027`,0.6084407015024677`,0.6595428157624766`,0.6899826497873729`,0.6794191700528721`,0.6772261559222542`,0.67231659519874`,0.67310322253404`,0.7068049814294977`,0.7636814894356393`,0.8236269895733385`,0.8463040874192285`,0.8654721086100058`,0.8793047646166903`,0.8974405295609659`,0.8435059583850155`,0.8635161990404173`,0.8604197880622331`,0.840112205801861`,0.8070589845133457`,0.8261335831913437`,0.779691177482883`,0.7435831168635111`,0.7319164501968445`,0.7384279072386777`,0.7476718926314759`,0.7752428614580287`,0.8139371289739522`,0.8511029043750217`,0.8824809781455134`,0.9208290607413837`,0.9574782754010696`,0.9824782754010695`,0.9953125`,1.`,1.`,1.`,1.`,1.`,1.`,1.`,1.`,1.`,1.`,1.`,1.`,1.`,1.`,1.`}},{{0.4812710593619599`,0.4961452012383902`,0.489197053090242`,0.4962646562509092`,0.4485602889496774`,0.46925701026115285`,0.4439158796568643`,0.4391654770803748`,0.49190179548833496`,0.6238166891053564`,0.6039920608171366`,0.6426705119955879`,0.6424440627202256`,0.7091107293868922`,0.6354265188605764`,0.7408044258373206`,0.7329071760283061`,0.7508250754365902`,0.690065581765704`,0.6682274042323183`,0.5793317731643571`,0.5844180181886827`,0.5686727378280176`,0.5294322314989037`,0.5065080176168577`,0.5016536486848189`,0.4986338039911174`,0.4995861849434984`,0.5205442687758337`,0.5562322500279261`,0.5501098010483342`,0.5654103474964217`,0.5854103474964217`,0.575927673500152`,0.5910095265130394`,0.5916774300380858`,0.5914451420009197`,0.6181741139635366`,0.632824830253597`,0.6345222164870656`,0.670503077731085`,0.6739237715653525`,0.6708374112865845`,0.6622295333356408`,0.6340454906544262`,0.6316547680852915`,0.6289358458562652`,0.6244481637498811`,0.6624158089916266`,0.7319293731721626`,0.7308010792218966`,0.7393711436764203`,0.7426998742296744`,0.7531714276212572`,0.7401070018509491`,0.7605045468715336`,0.7814649988489347`,0.7969600621224711`,0.8171297829440182`,0.8516778417453751`,0.8933354974547177`,0.9255453396088495`,0.9607245109414363`,0.9745973433113786`,0.9777635702243073`,0.9887010702243073`,0.9931578947368422`,1.`,1.`,1.`,1.`,1.`,1.`,1.`,1.`,1.`},{0.5127023487329317`,0.5213185885582247`,0.4921713017365192`,0.5341915037567212`,0.5314888010540185`,0.5314888010540185`,0.5364375461936438`,0.577987933790543`,0.5137455095481188`,0.5280312238338329`,0.5509362517667941`,0.560480260250357`,0.5179042316278168`,0.5745708982944835`,0.5772663160842408`,0.5761657994294754`,0.5544266689946928`,0.5893917039597277`,0.5601760176852181`,0.5484580435044831`,0.5687587953841824`,0.5618622436600446`,0.5552244370222378`,0.5611067899634142`,0.5566983329233782`,0.5260434514448729`,0.5877787128464302`,0.5546437922115096`,0.5884368956597854`,0.6314418439278916`,0.5998079760099702`,0.5399692663325508`,0.605410442803139`,0.6046016325485805`,0.5878008069551852`,0.6386661113755355`,0.6372333628375237`,0.5863540420370387`,0.5669290708772197`,0.5809957884733489`,0.5901741101516707`,0.6176594902686299`,0.6390949023580896`,0.6540027336088627`,0.6355187019172839`,0.6218330587014393`,0.6565877925615854`,0.6822654422937718`,0.7212401494742167`,0.7572578579173492`,0.7920208612730539`,0.7931456492262909`,0.7808754936393036`,0.737217416957971`,0.7441137546364316`,0.7783890205938784`,0.7830784888231697`,0.8296843652162802`,0.893944059693366`,0.926744668521372`,0.9171672616799473`,0.9461215562886922`,0.9152035105834124`,0.9271600323225428`,0.9288038679389813`,0.921589561454538`,0.9205697809944067`,0.967977188401814`,0.947977188401814`,0.947977188401814`,0.9695561357702349`,0.9800000000000001`,0.9800000000000001`,1.`,1.`,1.`}}},{{0.007794420177383484`,0.007796872540063302`},{0.008112629120149251`,0.007462983530199686`}},{{{-53.`,1330.`},{-49.`,6021.`},{-46.`,5288.`},{-42.`,5472.`},{-39.`,1731.`},{-35.`,2654.`},{-31.`,1769.`},{-28.`,7152.`},{-25.`,2167.`},{-21.`,5827.`},{-18.`,1405.`},{-14.`,6646.`},{-11.`,3962.`},{-7.`,8867.`},{-4.`,10210.`},{0.`,13902.`},{3.`,6800.`},{7.`,11206.`},{10.`,6613.`},{14.`,7667.`},{17.`,7412.`},{21.`,9409.`},{24.`,6358.`},{28.`,10037.`},{31.`,9797.`},{35.`,13368.`},{38.`,3615.`},{42.`,7315.`},{45.`,6287.`},{49.`,8383.`},{52.`,3104.`},{56.`,4597.`},{59.`,2733.`},{63.`,986.`},{66.`,2756.`},{70.`,5593.`},{73.`,895.`},{77.`,3041.`},{80.`,3550.`},{84.`,3310.`},{87.`,1809.`},{91.`,4244.`},{94.`,1941.`},{98.`,7055.`},{101.`,2519.`},{105.`,2649.`},{108.`,1781.`},{112.`,3250.`},{115.`,4055.`},{119.`,6545.`},{122.`,3277.`},{126.`,4428.`},{129.`,4976.`},{133.`,3871.`},{136.`,2422.`},{140.`,3868.`},{143.`,3182.`},{147.`,2987.`},{150.`,4033.`},{154.`,9894.`},{157.`,3480.`},{161.`,3161.`},{164.`,4714.`},{168.`,10045.`},{171.`,12116.`},{175.`,9780.`},{178.`,7474.`},{182.`,12945.`},{185.`,10667.`},{189.`,8394.`},{192.`,9567.`},{196.`,13079.`},{199.`,17072.`},{203.`,19370.`},{206.`,8175.`},{210.`,3818.`},{213.`,2423.`},{217.`,7076.`},{220.`,12679.`},{224.`,11606.`},{227.`,3646.`},{231.`,14940.`},{234.`,10940.`},{238.`,6061.`},{241.`,11124.`},{245.`,8671.`},{248.`,9975.`}},{{-53.`,707.`},{-49.`,1419.`},{-46.`,1903.`},{-42.`,3471.`},{-39.`,1508.`},{-35.`,1897.`},{-31.`,349.`},{-28.`,1176.`},{-25.`,1216.`},{-21.`,2078.`},{-18.`,1569.`},{-14.`,6129.`},{-11.`,2009.`},{-7.`,2779.`},{-4.`,3056.`},{0.`,1211.`},{3.`,4552.`},{7.`,7745.`},{10.`,4088.`},{14.`,3989.`},{17.`,2930.`},{21.`,5425.`},{24.`,3391.`},{28.`,3887.`},{31.`,4650.`},{35.`,6345.`},{38.`,3695.`},{42.`,1867.`},{45.`,872.`},{49.`,3504.`},{52.`,5416.`},{56.`,6142.`},{59.`,1507.`},{63.`,2048.`},{66.`,2391.`},{70.`,3413.`},{73.`,815.`},{77.`,3754.`},{80.`,3765.`},{84.`,2017.`},{87.`,1663.`},{91.`,4641.`},{94.`,3539.`},{98.`,4001.`},{101.`,2415.`},{105.`,2876.`},{108.`,1747.`},{112.`,2046.`},{115.`,1077.`},{119.`,2325.`},{122.`,1392.`},{126.`,2679.`},{129.`,2327.`},{133.`,2414.`},{136.`,3152.`},{140.`,3800.`},{143.`,1758.`},{147.`,3504.`},{150.`,2633.`},{154.`,4397.`},{157.`,7720.`},{161.`,7639.`},{164.`,5253.`},{168.`,4679.`},{171.`,9409.`},{175.`,8398.`},{178.`,10780.`},{182.`,10925.`},{185.`,10001.`},{189.`,6884.`},{192.`,7312.`},{196.`,11339.`},{199.`,9730.`},{203.`,14946.`},{206.`,7111.`},{210.`,7085.`},{213.`,7165.`},{217.`,8506.`},{220.`,7869.`},{224.`,7681.`},{227.`,2119.`},{231.`,7885.`},{234.`,11635.`},{238.`,6887.`},{241.`,5705.`},{245.`,8973.`},{248.`,10571.`}},{{-53.`,1478.`},{-49.`,1960.`},{-46.`,2022.`},{-42.`,3095.`},{-39.`,1295.`},{-35.`,2346.`},{-31.`,1337.`},{-28.`,7619.`},{-25.`,1356.`},{-21.`,3378.`},{-18.`,2531.`},{-14.`,6388.`},{-11.`,3392.`},{-7.`,4032.`},{-4.`,3964.`},{0.`,4624.`},{3.`,5174.`},{7.`,5350.`},{10.`,10247.`},{14.`,10569.`},{17.`,6508.`},{21.`,4146.`},{24.`,4708.`},{28.`,5148.`},{31.`,5217.`},{35.`,7011.`},{38.`,3171.`},{42.`,2034.`},{45.`,654.`},{49.`,1334.`},{52.`,1372.`},{56.`,2105.`},{59.`,1903.`},{63.`,1705.`},{66.`,2106.`},{70.`,1164.`},{73.`,446.`},{77.`,3437.`},{80.`,2779.`},{84.`,1393.`},{87.`,2349.`},{91.`,4845.`},{94.`,3141.`},{98.`,4012.`},{101.`,1859.`},{105.`,3125.`},{108.`,1098.`},{112.`,1011.`},{115.`,1615.`},{119.`,1042.`},{122.`,1962.`},{126.`,2596.`},{129.`,2418.`},{133.`,2208.`},{136.`,709.`},{140.`,975.`},{143.`,576.`},{147.`,1584.`},{150.`,1151.`},{154.`,2337.`},{157.`,2433.`},{161.`,4222.`},{164.`,3204.`},{168.`,4627.`},{171.`,7881.`},{175.`,4611.`},{178.`,3469.`},{182.`,6540.`},{185.`,2968.`},{189.`,2132.`},{192.`,1568.`},{196.`,6429.`},{199.`,5797.`},{203.`,8639.`},{206.`,6101.`},{210.`,2441.`},{213.`,1635.`},{217.`,3386.`},{220.`,3310.`},{224.`,6349.`},{227.`,3721.`},{231.`,11879.`},{234.`,4058.`},{238.`,5133.`},{241.`,4173.`},{245.`,4861.`},{248.`,2522.`}},{{-53.`,2040.`},{-49.`,4478.`},{-46.`,3291.`},{-42.`,3385.`},{-39.`,4460.`},{-35.`,1993.`},{-31.`,288.`},{-28.`,1746.`},{-25.`,3568.`},{-21.`,1628.`},{-18.`,961.`},{-14.`,6477.`},{-11.`,3329.`},{-7.`,3095.`},{-4.`,3902.`},{0.`,2396.`},{3.`,3334.`},{7.`,6369.`},{10.`,5259.`},{14.`,5239.`},{17.`,3235.`},{21.`,4315.`},{24.`,1841.`},{28.`,4563.`},{31.`,3001.`},{35.`,3483.`},{38.`,2378.`},{42.`,1507.`},{45.`,1888.`},{49.`,2313.`},{52.`,4213.`},{56.`,1107.`},{59.`,739.`},{63.`,1263.`},{66.`,829.`},{70.`,857.`},{73.`,590.`},{77.`,2580.`},{80.`,3760.`},{84.`,1344.`},{87.`,2070.`},{91.`,3040.`},{94.`,2216.`},{98.`,2155.`},{101.`,1182.`},{105.`,2421.`},{108.`,824.`},{112.`,536.`},{115.`,1322.`},{119.`,4456.`},{122.`,2344.`},{126.`,1935.`},{129.`,1524.`},{133.`,2240.`},{136.`,766.`},{140.`,2670.`},{143.`,2569.`},{147.`,1156.`},{150.`,1107.`},{154.`,1526.`},{157.`,1121.`},{161.`,576.`},{164.`,572.`},{168.`,1442.`},{171.`,1990.`},{175.`,1419.`},{178.`,330.`},{182.`,3004.`},{185.`,3620.`},{189.`,3154.`},{192.`,1965.`},{196.`,3198.`},{199.`,2293.`},{203.`,4904.`},{206.`,2485.`},{210.`,565.`},{213.`,1161.`},{217.`,1877.`},{220.`,795.`},{224.`,1624.`},{227.`,299.`},{231.`,256.`},{234.`,116.`},{238.`,1.`},{241.`,38.`},{245.`,1.`},{248.`,1.`}},{{-53.`,1138.`},{-49.`,1169.`},{-46.`,1419.`},{-42.`,2068.`},{-39.`,2135.`},{-35.`,1552.`},{-31.`,1235.`},{-28.`,3807.`},{-25.`,1411.`},{-21.`,4772.`},{-18.`,2822.`},{-14.`,4502.`},{-11.`,1239.`},{-7.`,3628.`},{-4.`,4183.`},{0.`,9550.`},{3.`,4845.`},{7.`,11201.`},{10.`,8417.`},{14.`,8018.`},{17.`,5307.`},{21.`,6330.`},{24.`,5831.`},{28.`,5908.`},{31.`,4775.`},{35.`,5996.`},{38.`,2088.`},{42.`,785.`},{45.`,637.`},{49.`,1030.`},{52.`,2086.`},{56.`,3779.`},{59.`,1755.`},{63.`,1038.`},{66.`,807.`},{70.`,662.`},{73.`,409.`},{77.`,927.`},{80.`,1878.`},{84.`,1461.`},{87.`,1166.`},{91.`,1995.`},{94.`,1822.`},{98.`,1766.`},{101.`,2459.`},{105.`,1029.`},{108.`,846.`},{112.`,1448.`},{115.`,2291.`},{119.`,4036.`},{122.`,2003.`},{126.`,2052.`},{129.`,1062.`},{133.`,2647.`},{136.`,2634.`},{140.`,1318.`},{143.`,514.`},{147.`,1496.`},{150.`,1106.`},{154.`,3504.`},{157.`,2953.`},{161.`,4834.`},{164.`,1667.`},{168.`,4732.`},{171.`,2164.`},{175.`,2777.`},{178.`,5757.`},{182.`,4641.`},{185.`,3455.`},{189.`,1742.`},{192.`,2387.`},{196.`,10699.`},{199.`,3308.`},{203.`,2353.`},{206.`,1745.`},{210.`,389.`},{213.`,327.`},{217.`,1558.`},{220.`,2222.`},{224.`,1419.`},{227.`,1132.`},{231.`,2416.`},{234.`,1579.`},{238.`,1174.`},{241.`,577.`},{245.`,538.`},{248.`,306.`}},{{-53.`,351.`},{-49.`,3107.`},{-46.`,1083.`},{-42.`,2069.`},{-39.`,2451.`},{-35.`,1904.`},{-31.`,421.`},{-28.`,2285.`},{-25.`,1314.`},{-21.`,2511.`},{-18.`,704.`},{-14.`,4737.`},{-11.`,2581.`},{-7.`,5486.`},{-4.`,4756.`},{0.`,5729.`},{3.`,4274.`},{7.`,5812.`},{10.`,4088.`},{14.`,4026.`},{17.`,2190.`},{21.`,3369.`},{24.`,2214.`},{28.`,3335.`},{31.`,4996.`},{35.`,4991.`},{38.`,3093.`},{42.`,3140.`},{45.`,2030.`},{49.`,3781.`},{52.`,651.`},{56.`,6737.`},{59.`,1481.`},{63.`,1978.`},{66.`,1073.`},{70.`,380.`},{73.`,615.`},{77.`,713.`},{80.`,1259.`},{84.`,639.`},{87.`,300.`},{91.`,1737.`},{94.`,987.`},{98.`,1426.`},{101.`,912.`},{105.`,1202.`},{108.`,1060.`},{112.`,470.`},{115.`,964.`},{119.`,3099.`},{122.`,3277.`},{126.`,825.`},{129.`,2829.`},{133.`,5859.`},{136.`,854.`},{140.`,3457.`},{143.`,6121.`},{147.`,7212.`},{150.`,2377.`},{154.`,4153.`},{157.`,3940.`},{161.`,4556.`},{164.`,2747.`},{168.`,1953.`},{171.`,6538.`},{175.`,2977.`},{178.`,3325.`},{182.`,8431.`},{185.`,4866.`},{189.`,3885.`},{192.`,1661.`},{196.`,6165.`},{199.`,5601.`},{203.`,8571.`},{206.`,2602.`},{210.`,3034.`},{213.`,1718.`},{217.`,1793.`},{220.`,4181.`},{224.`,2679.`},{227.`,1146.`},{231.`,4904.`},{234.`,2551.`},{238.`,921.`},{241.`,328.`},{245.`,315.`},{248.`,825.`}}}};
(*--------------------------------------------------------------------------*)
(*-------------Functions for computing  transgene frequency and male frequency time series from simulated data------*)
freq[re_]:=Map[({#[[1]],If[Total[#[[{2,3}]]]>0,(#[[3]])/
(Total[#[[{2,3}]]]),1]})&,re];
MaleHomo[re_]:=Map[({#[[1]],If[#[[3]]>0,(#[[4]]/#[[3]]),1]})&,re];
r2freq[re_]:=Map[({#[[1]],If[#[[5]]>0,(#[[8]])/
(2#[[5]]),0]})&,re];
(*--------------------------------------------------------------------------*)
(*-----------r2 frequency data and function for computing likelihood of simulated data from this---------*)

r2data={{{0,0,Round[1200 .00308],0},{0,Round[1200 .018607],0}},{{0,0},{0,Round[0.039268 1200]}}}
r2Samps={{{1200,1200,1200,450},{1200,225}},{{450,1200},{300,1200}}};
r2times={44,70,88,92};

loglik[res_]:=Block[{},
ff=N[10^-5+Table[r2freq[res[[exp,rep]]][[r2times,2]],{exp,2,3,1},
{rep,Length[res[[1]]]}]];
Total[Flatten[Table[Sum[Log[PDF[BinomialDistribution[r2Samps[[exp,repdata,tt]],
ff[[exp,repsim,tt]]],r2data[[exp,repdata]]]],{tt,Length[r2Samps[[exp,repdata]]]}],
{exp,2},{repdata,2},{repsim,Length[res[[1]]]}]]]];
(*--------------------------------------------------------------------------*)

(*-----Function that samples parameters from (uniform) prior, runs simulation, and computes distance measures---------*)
samp[NumRuns_,xifit_,frhofit_,mrhofit_,thetafit_,playfit_,gfit_,pname_,data_,OtherParameters_]:=
Block[{xip,frp,mrp,thetap,playp,gam,res,pp,rr,freqsimpos,Malesimpos,SmoothSim,TrimSim,
ResidSim,ResidVarSim,SmoothMaleSim,TrimMaleSim,ResidMaleSim,ResidMaleVarSim,eggTot,
d1,d2,d3,d4,d5,d6,d7,SmoothData,ResidVarData,SmoothMaleData,ResidMaleVarData,eggs,
kFS,kFE,kMS,kME,lamFS,lamFE,lamMS,lamME,eff,emm,beta,maxT,startNum,drivertime,numEggs,gammaF,gammaM,numDsx},
{SmoothData,ResidVarData,SmoothMaleData,ResidMaleVarData,eggs}=data;
{kFS,kFE,kMS,kME,lamFS,lamFE,lamMS,lamME,eff,emm,beta,maxT,startNum,drivertime,numEggs}=OtherParameters;
xip=RandomReal[xifit];
frp=RandomReal[frhofit];
mrp=RandomReal[mrhofit];
thetap=RandomReal[thetafit];
playp=RandomReal[playfit];
gam=RandomReal[gfit];
res={0,0,0};
Do[
pp={maxT,NumRuns,startNum,drivertime,gammaF=(1-eff)gam,gammaM=(1-emm)gam,beta,thetap,
playp,xip,frp,mrp,eff,emm,lamFS,lamFE,lamMS,lamME,kFS,kFE,kMS,kME,
numEggs,numDsx={0,0.25,0.5}[[expt]]};

Export[pname,pp,"CSV","TextDelimiters"->""];
rr=Import["!./RunSimulation<"<>pname,"Table"];
res[[expt]]=Partition[rr,(Length[rr]/NumRuns)],{expt,3}];

freqsimpos=Table[Drop[freq[res[[ex,rep]]],25],{ex,2,3,1},
{rep,Length[res[[1]]]}];
Malesimpos=Table[Drop[MaleHomo[res[[ex,rep]]],25],{ex,2,3,1},
{rep,Length[res[[1]]]}];

SmoothSim=Table[MovingAverage[freqsimpos[[ex,rep,All,2]],5],
{ex,2},{rep,Length[res[[1]]]}];
TrimSim=Table[freqsimpos[[ex,rep,3;;Length[freqsimpos[[ex,rep]]]-2,2]],
{ex,2},{rep,Length[res[[1]]]}];
ResidSim=SmoothSim-TrimSim;
ResidVarSim=Table[Variance[ResidSim[[ex,rep]]],{ex,2},{rep,Length[res[[1]]]}];
d1=Sum[Total[(SmoothSim[[ex,simrep]]-SmoothData[[ex,datarep]])^2],{ex,2},
{simrep,Length[res[[1]]]},{datarep,2}];
d2=Sum[(ResidVarSim[[ex,simrep]]-ResidVarData[[ex,datarep]])^2,{ex,2},
{simrep,Length[res[[1]]]},{datarep,2}];

SmoothMaleSim=Table[MovingAverage[Malesimpos[[ex,rep,All,2]],5],
{ex,2},{rep,Length[res[[1]]]}];
TrimMaleSim=Table[Malesimpos[[ex,rep,3;;Length[Malesimpos[[ex,rep]]]-2,2]],
{ex,2},{rep,Length[res[[1]]]}];
ResidMaleSim=SmoothMaleSim-TrimMaleSim;
ResidMaleVarSim=Table[Variance[ResidMaleSim[[ex,rep]]],
{ex,2},{rep,Length[res[[1]]]}];

d1=Sum[Total[(SmoothSim[[ex,simrep]]-SmoothData[[ex,datarep]])^2],{ex,2},
{simrep,Length[res[[1]]]},{datarep,2}];
d2=Sum[(ResidVarSim[[ex,simrep]]-ResidVarData[[ex,datarep]])^2,{ex,2},
{simrep,Length[res[[1]]]},{datarep,2}];

d3=Sum[Total[(SmoothMaleSim[[ex,simrep]]-SmoothMaleData[[ex,datarep]])^2],{ex,2},
{simrep,Length[res[[1]]]},{datarep,2}];
d4=Sum[(ResidMaleVarSim[[ex,simrep]]-ResidMaleVarData[[ex,datarep]])^2,{ex,2},
{simrep,Length[res[[1]]]},{datarep,2}];

eggTot=Table[Drop[res[[1,rep,All,5]],6],{rep,Length[res[[1]]]}];

d5=Sum[(Mean[eggTot[[rep]]]-Mean[eggs[[exp2,All,2]]])^2,
{rep,Length[res[[1]]]},{exp2,2},{rep2,2}];
d6=Sum[(Variance[eggTot[[rep]]]-Variance[eggs[[exp2,All,2]]])^2,{exp2,2},
{rep,Length[res[[1]]]},{rep2,2}];

d7=loglik[res];

{{xip,frp,mrp,thetap,playp,gam},{d1,d2,d3,d4,d5,d6,d7}}];
